# Android è¯­éŸ³æ¶ˆæ¯é€šé“äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

## 1. äº§å“æ¦‚è¿°

### 1.1 äº§å“åç§°

**OpenClaw Android Voice Channel** - å®‰å“è¯­éŸ³æ¶ˆæ¯é€šé“

### 1.2 äº§å“å®šä½

åŸºäº OpenClaw ç°æœ‰è¯­éŸ³åŠŸèƒ½ï¼ˆVoiceWakeManagerã€TalkModeManagerï¼‰è¿›è¡Œæ‰©å±•ï¼Œæ–°å¢**è¯´è¯äººè¯†åˆ«**å’Œ**é—½å—è¯­æ”¯æŒ**ä¸¤å¤§æ ¸å¿ƒèƒ½åŠ›ã€‚

### 1.3 æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **è¯´è¯äººè¯†åˆ«**ï¼šè¯†åˆ«ä¸åŒè¯´è¯äººï¼Œé€šè¿‡å£°çº¹ ID è®©æ™ºèƒ½ä½“åŒºåˆ†è¯´è¯äºº
- **é—½å—è¯­æ”¯æŒ**ï¼šæ”¯æŒå°æ¹¾é—½å—è¯­ï¼ˆHokkienï¼‰è¯­éŸ³è¾“å…¥
- **æ— ç¼é›†æˆ**ï¼šå¤ç”¨ç°æœ‰ OpenClaw Android App è¯­éŸ³æ¶æ„

---

## 2. è¯¦ç»†åŠŸèƒ½åˆ—è¡¨

### 2.1 æ–°å¢æ ¸å¿ƒåŠŸèƒ½

#### 2.1.1 è¯´è¯äººè¯†åˆ«ï¼ˆSpeaker Recognitionï¼‰

- **åŠŸèƒ½æè¿°**ï¼šGateway å±‚å£°çº¹è¯†åˆ«ï¼ŒåŸºäºå£°çº¹ç‰¹å¾ç”Ÿæˆå”¯ä¸€ IDï¼Œæ™ºèƒ½ä½“é€šè¿‡ ID è¯†åˆ«ä¸åŒè¯´è¯äºº
- **è¯¦ç»†éœ€æ±‚**ï¼š
  - **Gateway å£°çº¹æ³¨å†Œ**ï¼šAndroid å°†è¯­éŸ³æ ·æœ¬å‘é€åˆ° Gatewayï¼ŒGateway æå–å£°çº¹ç‰¹å¾å¹¶ç”Ÿæˆå”¯ä¸€ ID
  - **Gateway å®æ—¶è¯†åˆ«**ï¼šè¯­éŸ³è¾“å…¥åï¼ŒGateway åŒ¹é…å£°çº¹ç‰¹å¾å¹¶è¿”å›å¯¹åº”çš„å”¯ä¸€ ID
  - **å£°çº¹ ID ç”Ÿæˆè§„åˆ™**ï¼šåŸºäºå£°çº¹ç‰¹å¾å“ˆå¸Œç”Ÿæˆï¼Œç¡®ä¿ç›¸åŒå£°çº¹å§‹ç»ˆå¾—åˆ°ç›¸åŒ ID
    - æ ¼å¼ï¼š`spk_{hash}_{gender}`ï¼ˆå¦‚ `spk_a3f7b2_M`ï¼‰
    - hashï¼šå£°çº¹ç‰¹å¾çš„å‰ 6 ä½åå…­è¿›åˆ¶å“ˆå¸Œå€¼
    - genderï¼šå¯é€‰ï¼ŒM/F/U
  - **ID ä¸€è‡´æ€§ä¿è¯**ï¼šç›¸åŒçš„å£°çº¹ç‰¹å¾åœ¨ä»»ä½•è®¾å¤‡ã€ä»»ä½•æ—¶é—´æ³¨å†Œï¼Œéƒ½è¿”å›ç›¸åŒçš„ ID
  - **ID ä¸æ™ºèƒ½ä½“è§£è€¦**ï¼šå£°çº¹ ID ä¸ç»‘å®šå…·ä½“äººç‰©ä¿¡æ¯ï¼Œæ™ºèƒ½ä½“é€šè¿‡é•¿æœŸè®°å¿†è‡ªè¡Œå…³è” ID ä¸äººç‰©
  - è¯†åˆ«ç½®ä¿¡åº¦é˜ˆå€¼å¯é…ç½®ï¼ˆé»˜è®¤ 80%ï¼‰
  - æœªçŸ¥è¯´è¯äººè¿”å›ä¸´æ—¶ IDï¼ˆå¦‚ `spk_unknown_xxx`ï¼‰
  - å£°çº¹æ•°æ®å­˜å‚¨åœ¨ Gatewayï¼ŒAndroid ä»…ç¼“å­˜ ID åˆ—è¡¨
  - **æ— éœ€ä¼šè¯éš”ç¦»**ï¼šOpenClaw æœ¬èº«æ”¯æŒç¾¤èŠæ¶ˆæ¯å¤„ç†ï¼Œæ™ºèƒ½ä½“é€šè¿‡å£°çº¹ ID åŒºåˆ†ä¸åŒè¯´è¯äºº

#### 2.1.2 é—½å—è¯­è¯­éŸ³è¯†åˆ«ï¼ˆSTTï¼‰

- **åŠŸèƒ½æè¿°**ï¼šæ”¯æŒç¦å»ºé—½å—è¯­ï¼ˆHokkienï¼‰è¯­éŸ³è¾“å…¥
- **è¯¦ç»†éœ€æ±‚**ï¼š
  - è¯­è¨€ä»£ç ï¼š`nan`ï¼ˆé—½å—è¯­ï¼‰
  - æ”¯æŒé—½å—è¯­ä¸æ™®é€šè¯æ··åˆè¾“å…¥ï¼ˆcode-switchingï¼‰
  - è¯†åˆ«å‡†ç¡®ç‡ç›®æ ‡ï¼š> 85%
  - æ¥å…¥æ”¯æŒé—½å—è¯­çš„äº‘ç«¯ STT æœåŠ¡
  - ç”¨æˆ·å¯åˆ‡æ¢è¯­è¨€æ¨¡å¼ï¼šæ™®é€šè¯ / é—½å—è¯­ / è‡ªåŠ¨æ£€æµ‹

### 2.2 ç°æœ‰åŠŸèƒ½å¤ç”¨ï¼ˆOpenClaw å·²å®ç°ï¼‰

ä»¥ä¸‹åŠŸèƒ½ç›´æ¥ä½¿ç”¨ç°æœ‰å®ç°ï¼Œæ— éœ€é‡å¤å¼€å‘ï¼š

| åŠŸèƒ½                    | ç°æœ‰å®ç°ä½ç½®          | è¯´æ˜                  |
| ----------------------- | --------------------- | --------------------- |
| è¯­éŸ³å”¤é†’                | `VoiceWakeManager.kt` | å”¤é†’è¯ç›‘å¬ã€æ¿€æ´»      |
| å®æ—¶å¯¹è¯                | `TalkModeManager.kt`  | å¯¹è¯æµç¨‹ã€æ‰“æ–­æ”¯æŒ    |
| è¯­éŸ³è¯†åˆ«ï¼ˆæ™®é€šè¯/è‹±æ–‡ï¼‰ | `TalkModeManager.kt`  | é€šè¿‡ Gateway è°ƒç”¨     |
| è¯­éŸ³åˆæˆï¼ˆTTSï¼‰         | `TalkModeManager.kt`  | ElevenLabs / ç³»ç»Ÿ TTS |
| Gateway è¿æ¥            | `GatewaySession.kt`   | WebSocket é€šä¿¡        |
| æ¶ˆæ¯è·¯ç”±                | Gateway å±‚            | ä¸ Agent äº¤äº’         |

---

## 3. åŠŸèƒ½ä¼˜å…ˆçº§

### 3.1 MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰

| ä¼˜å…ˆçº§ | åŠŸèƒ½             | è¯´æ˜                     | éªŒæ”¶æ ‡å‡†         |
| ------ | ---------------- | ------------------------ | ---------------- |
| P0     | Gateway å£°çº¹è¯†åˆ« | å£°çº¹æ³¨å†Œ + å®æ—¶è¯†åˆ«      | è¯†åˆ«å‡†ç¡®ç‡ > 85% |
| P0     | é—½å—è¯­ STT       | æ¥å…¥æ”¯æŒé—½å—è¯­çš„äº‘ç«¯æœåŠ¡ | è¯†åˆ«å‡†ç¡®ç‡ > 85% |
| P1     | å£°çº¹ ID ç®¡ç†     | æŸ¥çœ‹/åˆ é™¤å£°çº¹ ID         | ç•Œé¢å¯ç”¨         |
| P1     | å£°çº¹ ID ç®¡ç†     | æŸ¥çœ‹/åˆ é™¤å£°çº¹ ID         | ç•Œé¢å¯ç”¨         |

### 3.2 åç»­ç‰ˆæœ¬

| ä¼˜å…ˆçº§ | åŠŸèƒ½         | è¯´æ˜                           |
| ------ | ------------ | ------------------------------ |
| P2     | é—½å—è¯­ TTS   | é—½å—è¯­è¯­éŸ³åˆæˆï¼ˆå¦‚æœ‰å¯ç”¨æœåŠ¡ï¼‰ |
| P2     | ç¦»çº¿å£°çº¹è¯†åˆ« | æœ¬åœ°å£°çº¹è¯†åˆ«æ¨¡å‹               |
| P3     | æƒ…æ„Ÿè¯†åˆ«     | ä»è¯­éŸ³ä¸­è¯†åˆ«æƒ…ç»ª               |

---

## 4. ç•Œé¢è®¾è®¡

### 4.1 å£°çº¹ ID ç®¡ç†ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å£°çº¹ ID ç®¡ç†               â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ¤ spk_a3f7b2_M     â”‚    â”‚  â† åŸºäºå£°çº¹ç‰¹å¾å“ˆå¸Œç”Ÿæˆçš„ ID
â”‚  â”‚ ç½®ä¿¡åº¦: 95%         â”‚    â”‚
â”‚  â”‚ æ³¨å†Œæ—¶é—´: 2026-02-04â”‚    â”‚
â”‚  â”‚ [åˆ é™¤]              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ¤ spk_9e2d1c_F     â”‚    â”‚  â† åŸºäºå£°çº¹ç‰¹å¾å“ˆå¸Œç”Ÿæˆçš„ ID
â”‚  â”‚ ç½®ä¿¡åº¦: 88%         â”‚    â”‚
â”‚  â”‚ æ³¨å†Œæ—¶é—´: 2026-02-03â”‚    â”‚
â”‚  â”‚ [åˆ é™¤]              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚
â”‚  [+ æ³¨å†Œæ–°å£°çº¹]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è¯­è¨€é€‰æ‹©ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯­è¨€è®¾ç½®                   â”‚
â”‚                             â”‚
â”‚  â—‹ æ™®é€šè¯ï¼ˆé»˜è®¤ï¼‰          â”‚
â”‚  â— é—½å—è¯­                 â”‚
â”‚  â—‹ è‡ªåŠ¨æ£€æµ‹                â”‚
â”‚                             â”‚
â”‚  [ä¿å­˜]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 å¯¹è¯ä¸­æ˜¾ç¤ºå£°çº¹ ID

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â— æ­£åœ¨è†å¬...              â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ¤ spk_a3f7b2_M:    â”‚    â”‚ â† æ˜¾ç¤ºè¯†åˆ«åˆ°çš„å£°çº¹ ID
â”‚  â”‚ "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ¤– OpenClaw:        â”‚    â”‚
â”‚  â”‚ "ä»Šå¤©å°åŒ—æ™´å¤©..."   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 5.1 Gateway å£°çº¹è¯†åˆ«æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Android App                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   SpeakerRecognitionManager     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ å£°çº¹æ³¨å†Œ â”‚  â”‚ å®æ—¶è¯†åˆ«     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (å‘é€)   â”‚  â”‚ (å‘é€)       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚       â”‚               â”‚         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ æœ¬åœ°å£°çº¹ ID åˆ—è¡¨           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (spk_id ç¼“å­˜)              â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   VoiceWakeManager    â”‚              â”‚
â”‚  â”‚   (å¤ç”¨ç°æœ‰)          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   TalkModeManager     â”‚              â”‚
â”‚  â”‚   (å¤ç”¨ç°æœ‰)          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         OpenClaw Gateway                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Speaker Recognition         â”‚   â”‚
â”‚  â”‚        Extension                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ å£°çº¹æ³¨å†Œ â”‚  â”‚ å®æ—¶è¯†åˆ«     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (å¤„ç†)   â”‚  â”‚ (å¤„ç†)       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚       â”‚               â”‚         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  å£°çº¹æ•°æ®å­˜å‚¨               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  (Gateway æœ¬åœ°)            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯é€‰å‹ï¼š**

| ç»„ä»¶              | æ–¹æ¡ˆ                                        | è¯´æ˜                                |
| ----------------- | ------------------------------------------- | ----------------------------------- |
| å£°çº¹è¯†åˆ«å¼•æ“      | Azure Speaker Recognition / Picovoice Eagle | Gateway å±‚é›†æˆ                      |
| Gateway Extension | TypeScript æ’ä»¶                             | å¤„ç†å£°çº¹æ³¨å†Œå’Œè¯†åˆ«                  |
| å£°çº¹ ID ç”Ÿæˆ      | Gateway å±‚ç”Ÿæˆ                              | åŸºäºç‰¹å¾å“ˆå¸Œï¼š`spk_{hash}_{gender}` |
| å£°çº¹æ•°æ®å­˜å‚¨      | Gateway æœ¬åœ°å­˜å‚¨                            | æ–‡ä»¶æˆ–æ•°æ®åº“                        |
| æ•°æ®ä¼ è¾“          | WebSocket + JSON                            | éŸ³é¢‘æ•°æ® Base64 ç¼–ç                 |
| Android ç¼“å­˜      | Room / DataStore                            | ä»…ç¼“å­˜å£°çº¹ ID åˆ—è¡¨                  |

### 5.2 é—½å—è¯­ STT æ–¹æ¡ˆ

**æ–¹æ¡ˆä¸€ï¼šWhisper APIï¼ˆæ¨èï¼‰**

- OpenAI Whisper æ”¯æŒé—½å—è¯­ï¼ˆnanï¼‰
- é€šè¿‡ Gateway è½¬å‘éŸ³é¢‘æµåˆ° Whisper API
- è¯­è¨€å‚æ•°è®¾ç½®ä¸º `"language": "nan"`

**æ–¹æ¡ˆäºŒï¼šGoogle Cloud Speech-to-Text**

- æ”¯æŒ `nan-TW` è¯­è¨€ä»£ç 
- éœ€è¦é…ç½® API Key

**å®ç°æ–¹å¼ï¼š**

```kotlin
// åœ¨ TalkModeManager ä¸­æ‰©å±•è¯­è¨€é€‰æ‹©
enum class SttLanguage {
    ZH,      // æ™®é€šè¯
    NAN_TW,  // å°æ¹¾é—½å—è¯­
    AUTO     // è‡ªåŠ¨æ£€æµ‹
}

// å‘é€è¯†åˆ«è¯·æ±‚æ—¶æºå¸¦è¯­è¨€å‚æ•°
fun sendSttRequest(audioData: ByteArray, language: SttLanguage) {
    val params = buildJsonObject {
        put("language", language.code)
        put("audio", audioData.base64())
    }
    session.request("stt.recognize", params.toString())
}
```

### 5.3 å£°çº¹ ID ä¸æ¶ˆæ¯å‘é€æ–¹æ¡ˆ

**å£°çº¹ ID ç”Ÿæˆè§„åˆ™ï¼š**

```kotlin
// åŸºäºå£°çº¹ç‰¹å¾å“ˆå¸Œç”Ÿæˆå”¯ä¸€ IDï¼Œç¡®ä¿ç›¸åŒå£°çº¹å§‹ç»ˆå¾—åˆ°ç›¸åŒ ID
// æ ¼å¼ï¼šspk_{hash}_{gender}
// ç¤ºä¾‹ï¼šspk_a3f7b2_M, spk_9e2d1c_F

data class SpeakerId(
    val id: String,           // å®Œæ•´ IDï¼Œå¦‚ "spk_a3f7b2_M"
    val hash: String,         // å£°çº¹ç‰¹å¾å“ˆå¸Œï¼ˆå‰6ä½åå…­è¿›åˆ¶ï¼‰
    val gender: String?       // M/F/Uï¼Œå¯é€‰
) {
    companion object {
        // åŸºäºå£°çº¹åµŒå…¥å‘é‡ç”Ÿæˆå“ˆå¸Œ
        fun generateFromEmbedding(embedding: FloatArray, gender: String? = null): String {
            // ä½¿ç”¨å£°çº¹ç‰¹å¾å‘é‡çš„å‰ N ç»´è®¡ç®—å“ˆå¸Œ
            val hash = computeHash(embedding)
            return "spk_${hash}_${gender ?: "U"}"
        }

        private fun computeHash(embedding: FloatArray): String {
            // å–å‰ 64 ç»´ç‰¹å¾è®¡ç®— SHA-256ï¼Œå–å‰ 6 ä½
            val bytes = embedding.take(64).map { it.toBits() }.toByteArray()
            val digest = MessageDigest.getInstance("SHA-256").digest(bytes)
            return digest.take(3).joinToString("") { "%02x".format(it) }
        }
    }
}

// ä¸€è‡´æ€§ä¿è¯ï¼š
// 1. ç›¸åŒçš„å£°çº¹ç‰¹å¾ â†’ ç›¸åŒçš„å“ˆå¸Œ â†’ ç›¸åŒçš„ ID
// 2. ä¸åŒè®¾å¤‡æ³¨å†Œç›¸åŒå£°çº¹ â†’ è¿”å›ç›¸åŒ ID
// 3. åŒä¸€å£°çº¹å¤šæ¬¡æ³¨å†Œ â†’ è¿”å›ç›¸åŒ IDï¼ˆå¹‚ç­‰æ€§ï¼‰
```

**æ¶ˆæ¯å‘é€æ–¹æ¡ˆï¼š**

```kotlin
// æ¶ˆæ¯å‘é€æ—¶æºå¸¦å£°çº¹ ID
// OpenClaw æœ¬èº«æ”¯æŒç¾¤èŠï¼Œæ™ºèƒ½ä½“é€šè¿‡ speakerId åŒºåˆ†ä¸åŒè¯´è¯äºº
fun sendMessageWithSpeakerId(text: String, speakerId: String?) {
    val params = buildJsonObject {
        put("message", text)
        put("speakerId", speakerId)  // æ™ºèƒ½ä½“é€šè¿‡æ­¤ ID è¯†åˆ«è¯´è¯äºº
        // ä¸éœ€è¦åˆ‡æ¢ä¼šè¯ï¼Œä½¿ç”¨é»˜è®¤ä¼šè¯å³å¯
        // OpenClaw çš„ç¾¤èŠèƒ½åŠ›ä¼šè‡ªåŠ¨å¤„ç†å¤šè¯´è¯äººåœºæ™¯
    }
    session.request("chat.send", params.toString())
}
```

**æ™ºèƒ½ä½“ä¾§å¤„ç†ï¼š**

- æ™ºèƒ½ä½“æ”¶åˆ° `speakerId` åï¼Œé€šè¿‡é•¿æœŸè®°å¿†å…³è” ID ä¸äººç‰©ä¿¡æ¯
- ä¾‹å¦‚ï¼šæ™ºèƒ½ä½“è®°ä½ "spk_a3f7b2_M" æ˜¯ "çˆ¸çˆ¸"ï¼Œ"spk_9e2d1c_F" æ˜¯ "å¦ˆå¦ˆ"
- å£°çº¹ ID æœ¬èº«ä¸åŒ…å«ä»»ä½•ä¸ªäººä¿¡æ¯ï¼Œä»…ä½œä¸ºæ ‡è¯†ç¬¦
- OpenClaw çš„ç¾¤èŠæ¶ˆæ¯å¤„ç†èƒ½åŠ›ä¼šè‡ªåŠ¨ç®¡ç†å¤šè¯´è¯äººå¯¹è¯ä¸Šä¸‹æ–‡

---

## 6. éåŠŸèƒ½æ€§éœ€æ±‚

### 6.1 æ€§èƒ½éœ€æ±‚

| æŒ‡æ ‡                 | ç›®æ ‡å€¼ | è¯´æ˜            |
| -------------------- | ------ | --------------- |
| Gateway å£°çº¹è¯†åˆ«å»¶è¿Ÿ | < 1s   | å«ç½‘ç»œä¼ è¾“æ—¶é—´  |
| å£°çº¹æ³¨å†Œæ—¶é—´         | < 30s  | å½•åˆ¶ 3-5 æ®µæ ·æœ¬ |
| é—½å—è¯­è¯†åˆ«å»¶è¿Ÿ       | < 1s   | ä¸æ™®é€šè¯ä¸€è‡´    |
| æœ¬åœ°ç¼“å­˜å¤§å°         | < 10KB | ä»… ID å’Œå…ƒæ•°æ®  |

### 6.2 å‡†ç¡®ç‡éœ€æ±‚

| æŒ‡æ ‡             | ç›®æ ‡å€¼ | è¯´æ˜          |
| ---------------- | ------ | ------------- |
| è¯´è¯äººè¯†åˆ«å‡†ç¡®ç‡ | > 85%  | å·²æ³¨å†Œè¯´è¯äºº  |
| é—½å—è¯­è¯†åˆ«å‡†ç¡®ç‡ | > 85%  | ç¦å»ºé—½å—è¯­    |
| è¯¯è¯†åˆ«ç‡         | < 5%   | å°† A è¯†åˆ«ä¸º B |

### 6.3 å®‰å…¨éœ€æ±‚

| éœ€æ±‚         | è¯´æ˜                     |
| ------------ | ------------------------ |
| å£°çº¹æ•°æ®åŠ å¯† | Gateway å±‚åŠ å¯†å­˜å‚¨       |
| ä¼ è¾“åŠ å¯†     | WebSocket over TLS (WSS) |
| éšç§ä¿æŠ¤     | å£°çº¹ ID ä¸åŒ…å«ä¸ªäººä¿¡æ¯   |

---

## 7. éªŒæ”¶æ ‡å‡†

### 7.1 åŠŸèƒ½éªŒæ”¶

- [ ] ç”¨æˆ·å¯ä»¥é€šè¿‡ Gateway æ³¨å†Œå£°çº¹ï¼ˆ3-5 æ®µè¯­éŸ³ï¼‰
- [ ] ç³»ç»Ÿèƒ½å‡†ç¡®è¯†åˆ«å·²æ³¨å†Œè¯´è¯äººå¹¶è¿”å›å£°çº¹ IDï¼ˆ> 85%ï¼‰
- [ ] å£°çº¹ ID åŸºäºå£°çº¹ç‰¹å¾å“ˆå¸Œç”Ÿæˆï¼Œæ ¼å¼ä¸º `spk_{hash}_{gender}`ï¼Œç›¸åŒå£°çº¹å§‹ç»ˆå¾—åˆ°ç›¸åŒ ID
- [ ] å£°çº¹ ID éšæ¶ˆæ¯å‘é€ç»™æ™ºèƒ½ä½“ï¼Œæ™ºèƒ½ä½“é€šè¿‡ ID åŒºåˆ†ä¸åŒè¯´è¯äºº
- [ ] æ”¯æŒé—½å—è¯­è¯­éŸ³è¾“å…¥å¹¶æ­£ç¡®è¯†åˆ«ï¼ˆ> 85%ï¼‰
- [ ] ç”¨æˆ·å¯åˆ‡æ¢è¯­è¨€æ¨¡å¼ï¼ˆæ™®é€šè¯/é—½å—è¯­ï¼‰

### 7.2 æ€§èƒ½éªŒæ”¶

- [ ] äº‘ç«¯å£°çº¹è¯†åˆ«å»¶è¿Ÿ < 1s
- [ ] é—½å—è¯­è¯†åˆ«å»¶è¿Ÿ < 1s
- [ ] å£°çº¹æ³¨å†Œæ—¶é—´ < 30s

---

## 8. é£é™©ä¸ç¼“è§£

| é£é™©                   | å½±å“ | ç¼“è§£æªæ–½                 |
| ---------------------- | ---- | ------------------------ |
| é—½å—è¯­ STT æœåŠ¡ä¸ç¨³å®š  | é«˜   | æä¾›æ™®é€šè¯å›é€€           |
| å£°çº¹è¯†åˆ«è¯¯è¯†åˆ«         | ä¸­   | ç½®ä¿¡åº¦é˜ˆå€¼å¯è°ƒ           |
| Gateway å£°çº¹æœåŠ¡ä¸å¯ç”¨ | ä¸­   | ä½¿ç”¨é»˜è®¤ä¼šè¯ç»§ç»­å¯¹è¯     |
| éšç§åˆè§„               | ä¸­   | å£°çº¹ ID åŒ¿ååŒ–ã€äº‘ç«¯åŠ å¯† |

---

## 9. é™„å½•

### 9.1 æœ¯è¯­è¡¨

| æœ¯è¯­                | è¯´æ˜                        |
| ------------------- | --------------------------- |
| Speaker Recognition | è¯´è¯äººè¯†åˆ«/å£°çº¹è¯†åˆ«         |
| Enrollment          | å£°çº¹æ³¨å†Œ                    |
| nan                 | é—½å—è¯­è¯­è¨€ä»£ç ï¼ˆISO 639-3ï¼‰ |
| Code-switching      | è¯­ç è½¬æ¢ï¼ˆæ··åˆè¯­è¨€ï¼‰        |

### 9.2 å‚è€ƒæ–‡æ¡£

- OpenClaw Android App: `apps/android/`
- VoiceWakeManager: `apps/android/app/src/main/java/ai/openclaw/android/voice/VoiceWakeManager.kt`
- TalkModeManager: `apps/android/app/src/main/java/ai/openclaw/android/voice/TalkModeManager.kt`
- Azure Speaker Recognition: https://azure.microsoft.com/services/cognitive-services/speaker-recognition/
- Whisper API: https://platform.openai.com/docs/guides/speech-to-text

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-04  
**æœ€åæ›´æ–°**: 2026-02-04  
**ä½œè€…**: OpenClaw Team
